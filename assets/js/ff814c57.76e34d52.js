"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[6227],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>f});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=c(a),d=r,f=m["".concat(s,".").concat(d)]||m[d]||p[d]||o;return a?n.createElement(f,l(l({ref:t},u),{},{components:a})):n.createElement(f,l({ref:t},u))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[m]="string"==typeof e?e:r,l[1]=i;for(var c=2;c<o;c++)l[c]=a[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},7277:(e,t,a)=>{a.r(t),a.d(t,{Compile:()=>v,UploadTab:()=>k,VisualizeTab:()=>h,assets:()=>g,contentTitle:()=>f,default:()=>O,frontMatter:()=>d,metadata:()=>b,toc:()=>y});var n=a(7462),r=a(7294),o=a(3905);const l="startButton_OY2G",i="visualizeCanvasWrapper_YP4_",s="visualizeCanvas_bKhT",c="tabItem_gCJA";var u=a(6010),m=a(2389);function p(e){let{children:t,fallback:a}=e;return(0,m.Z)()?r.createElement(r.Fragment,null,t?.()):a??null}const d={id:"compile",title:"Image Targets Compiler"},f=void 0,b={unversionedId:"tools/compile",id:"tools/compile",title:"Image Targets Compiler",description:"",source:"@site/docs/tools/compile.mdx",sourceDirName:"tools",slug:"/tools/compile",permalink:"/mind-ar-js-doc/tools/compile",draft:!1,tags:[],version:"current",frontMatter:{id:"compile",title:"Image Targets Compiler"},sidebar:"docs",previous:{title:"ThreeJS FaceMesh",permalink:"/mind-ar-js-doc/more-examples/threejs-face-facemesh"}},g={},y=[],k=e=>{let{onDataReady:t}=e;const[a,n]=(0,r.useState)(""),[i,s]=(0,r.useState)(null),[c,m]=(0,r.useState)(null),p=(0,r.useRef)(null),d=new window.MINDAR.IMAGE.Compiler,f=(0,r.useCallback)((async e=>new Promise(((t,a)=>{let n=new Image;n.onload=()=>t(n),n.onerror=a,n.src=URL.createObjectURL(e)}))),[]),b=(0,r.useCallback)((async e=>{m(0);const a=[];for(let t=0;t<e.length;t++)a.push(await f(e[t]));console.log("files",e,a);const n=await d.compileImageTargets(a,(e=>{m(e.toFixed(2))})),r=await d.exportData();t(n,r)}),[]),g=(0,r.useCallback)((async e=>{var a=new FileReader;a.onload=async function(){const e=d.importData(this.result),a=await d.exportData();t(e,a)},a.readAsArrayBuffer(e)}),[]);(0,r.useEffect)((()=>{console.log("use effect",p.current);const e=new Dropzone(p.current,{url:"#",autoProcessQueue:!1,addRemoveLinks:!0});s(e)}),[]);const y=(0,r.useCallback)((async()=>{const e=i.files;if(0===e.length)return void n("please select images.");"mind"===e[0].name.split(".").pop()?g(e[0]):b(e)}),[i]);return(0,o.kt)("div",null,(0,o.kt)("p",null,"Select target images and start"),(0,o.kt)("div",{ref:p,className:"dropzone"}),a&&(0,o.kt)("p",{className:"text--danger"},a),(0,o.kt)("div",{className:"padding-vert--md"},null===c&&(0,o.kt)("button",{className:(0,u.Z)("button","button--primary",l),onClick:y},"Start"),null!==c&&(0,o.kt)("div",null,"Progress: ",c," %")))},h=e=>{let{dataList:t,exportedBuffer:a}=e;const n=(0,r.useRef)(null),[m,p]=(0,r.useState)(0),[d,f]=(0,r.useState)(0),b=(0,r.useCallback)((function(e,t,a,n,r){void 0===r&&(r=1),e.beginPath(),e.arc(a,n,r,0,2*Math.PI,!1),e.fillStyle=t,e.lineWidth=1,e.strokeStyle=t,e.stroke()}),[]);(0,r.useCallback)(((e,t,a,n,r)=>{e.beginPath(),e.strokeStyle=t,e.rect(a-r/2,n-r/2,r,r),e.stroke()}),[]);(0,r.useEffect)((()=>{const e=t[m].imageList[d],a=[...t[m].matchingData[d].maximaPoints,t[m].matchingData[d].minimaPoints],r=n.current;r.width=e.width,r.height=e.height;const o=r.getContext("2d");o.clearRect(0,0,r.width,r.height);const l=new Uint8ClampedArray(e.width*e.height*4);for(let t=0;t<e.data.length;t++)l[4*t+0]=e.data[t],l[4*t+1]=e.data[t],l[4*t+2]=e.data[t],l[4*t+3]=255;const i=new ImageData(l,e.width,e.height);o.putImageData(i,0,0);for(let t=0;t<a.length;t++){const e=a[t];b(o,"#ff0000",Math.round(e.x),Math.round(e.y),e.scale)}}),[t,m,d]);const g=(0,r.useMemo)((()=>t.map(((e,t)=>t))),[t]),y=(0,r.useMemo)((()=>t[m].imageList.map(((e,t)=>t))),[t,m]),k=(0,r.useMemo)((()=>{const e=100*t[m].imageList[d].scale;return{width:e+"%",maxHeight:"100%",top:(100-e)/2+"%"}}),[t,m,d]),h=(0,r.useCallback)((()=>{var e=new Blob([a]),t=window.document.createElement("a");t.download="targets.mind",t.href=window.URL.createObjectURL(e),t.click(),window.URL.revokeObjectURL(t.href)}),[a]);return(0,o.kt)("div",null,(0,o.kt)("div",{className:"tabs-container"},(0,o.kt)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs")},g.map((e=>(0,o.kt)("li",{role:"tab",className:(0,u.Z)("tabs__item",{"tabs__item--active":m===e},c),key:e,onClick:()=>{p(e),f(0)}},"Image ",e+1))))),(0,o.kt)("div",{className:"tabs-container"},(0,o.kt)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs")},y.map((e=>(0,o.kt)("li",{role:"tab",className:(0,u.Z)("tabs__item",{"tabs__item--active":d===e},c),key:e,onClick:()=>{f(e)}},"Scale ",e+1))))),(0,o.kt)("div",{className:i},(0,o.kt)("canvas",{style:k,className:s,ref:n})),(0,o.kt)("div",{className:"padding-vert--md"},(0,o.kt)("button",{className:(0,u.Z)("button","button--primary",l),onClick:h},"Download compiled")))},v=()=>{const[e,t]=(0,r.useState)("upload"),[a,n]=(0,r.useState)(null),[l,i]=(0,r.useState)(null),s=(0,r.useCallback)(((e,a)=>{n(e),i(a),t("visualize")}),[]);return(0,o.kt)(p,{mdxType:"BrowserOnly"},(()=>(0,o.kt)("div",null,"upload"===e&&(0,o.kt)(k,{onDataReady:s,mdxType:"UploadTab"}),"visualize"===e&&(0,o.kt)(h,{dataList:a,exportedBuffer:l,mdxType:"VisualizeTab"}))))},w={toc:y,UploadTab:k,VisualizeTab:h,Compile:v};function O(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},w,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)(v,{mdxType:"Compile"}))}O.isMDXComponent=!0}}]);