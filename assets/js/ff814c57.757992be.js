(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{115:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return m})),a.d(t,"metadata",(function(){return f})),a.d(t,"toc",(function(){return v})),a.d(t,"UploadTab",(function(){return j})),a.d(t,"VisualizeTab",(function(){return O})),a.d(t,"Compile",(function(){return h})),a.d(t,"default",(function(){return g}));var n=a(3),r=a(7),c=a(189),o=a(190),i=a.n(o),s=a(0),u=a(123),l=a(192),b=a.n(l),d=a(146),p=(a(193),a(194),a(195)),m={id:"compile",title:"Image Targets Compiler"},f={unversionedId:"tools/compile",id:"tools/compile",isDocsHomePage:!1,title:"Image Targets Compiler",description:"const [error, setError] = useState('');",source:"@site/docs/tools/compile.mdx",slug:"/tools/compile",permalink:"/mind-ar-js-doc/tools/compile",version:"current",sidebar:"docs",previous:{title:"React",permalink:"/mind-ar-js-doc/more-examples/react"}},v=[],j=function(e){var t=e.onDataReady,a=Object(s.useState)(""),n=a[0],r=a[1],o=Object(s.useState)(null),l=o[0],p=o[1],m=Object(s.useState)(null),f=m[0],v=m[1],j=Object(s.useRef)(null),O=new window.MINDAR.Compiler,h=Object(s.useCallback)(function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){var n=new Image;n.onload=function(){return e(n)},n.onerror=a,n.src=URL.createObjectURL(t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),w=Object(s.useCallback)(function(){var e=Object(c.a)(i.a.mark((function e(a){var n,r,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v(0),n=[],r=0;case 3:if(!(r<a.length)){e.next=12;break}return e.t0=n,e.next=7,h(a[r]);case 7:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 9:r++,e.next=3;break;case 12:return console.log("files",a,n),e.next=15,O.compileImageTargets(n,(function(e){v(e.toFixed(2))}));case 15:return c=e.sent,e.next=18,O.exportData();case 18:o=e.sent,t(c,o);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),g=Object(s.useCallback)(function(){var e=Object(c.a)(i.a.mark((function e(a){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=new FileReader).onload=Object(c.a)(i.a.mark((function e(){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=O.importData(this.result),e.next=3,O.exportData();case 3:n=e.sent,t(a,n);case 5:case"end":return e.stop()}}),e,this)}))),n.readAsArrayBuffer(a);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);Object(s.useEffect)((function(){console.log("use effect",j.current);var e=new Dropzone(j.current,{url:"#",autoProcessQueue:!1,addRemoveLinks:!0});p(e)}),[]);var k=Object(s.useCallback)(Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=l.files).length){e.next=4;break}return r("please select images."),e.abrupt("return");case 4:"mind"===t[0].name.split(".").pop()?g(t[0]):w(t);case 6:case"end":return e.stop()}}),e)}))),[l]);return Object(u.a)("div",null,Object(u.a)("p",null,"Select target images and start"),Object(u.a)("div",{ref:j,className:"dropzone"}),n&&Object(u.a)("p",{className:"text--danger"},n),Object(u.a)("div",{className:"padding-vert--md"},null===f&&Object(u.a)("button",{className:Object(d.a)("button","button--primary",b.a.startButton),onClick:k},"Start"),null!==f&&Object(u.a)("div",null,"Progress: ",f," %")))},O=function(e){var t=e.dataList,a=e.exportedBuffer,n=Object(s.useRef)(null),r=Object(s.useState)(0),c=r[0],o=r[1],i=Object(s.useState)(0),l=i[0],p=i[1],m=Object(s.useCallback)((function(e,t,a,n,r){void 0===r&&(r=1),e.beginPath(),e.arc(a,n,r,0,2*Math.PI,!1),e.fillStyle=t,e.lineWidth=1,e.strokeStyle=t,e.stroke()}),[]),f=Object(s.useCallback)((function(e,t,a,n,r){e.beginPath(),e.strokeStyle=t,e.rect(a-r/2,n-r/2,r,r),e.stroke()}),[]);Object(s.useEffect)((function(){var e=t[c].imageList[l],a=t[c].matchingData[l].points,r=t[c].trackingData[l].points,o=n.current;o.width=e.width,o.height=e.height;var i=o.getContext("2d");i.clearRect(0,0,o.width,o.height);for(var s=new Uint8ClampedArray(e.width*e.height*4),u=0;u<e.data.length;u++)s[4*u+0]=e.data[u],s[4*u+1]=e.data[u],s[4*u+2]=e.data[u],s[4*u+3]=255;var b=new ImageData(s,e.width,e.height);i.putImageData(b,0,0);for(var d=0;d<a.length;d++){var p=a[d];m(i,"#ff0000",Math.round(p.x),Math.round(p.y),p.scale)}for(var v=0;v<r.length;v++){var j=r[v];f(i,"#0000ff",Math.round(j.x),Math.round(j.y),44)}}),[t,c,l]);var v=Object(s.useMemo)((function(){return t.map((function(e,t){return t}))}),[t]),j=Object(s.useMemo)((function(){return t[c].imageList.map((function(e,t){return t}))}),[t,c]),O=Object(s.useMemo)((function(){var e=100*t[c].imageList[l].scale;return{width:e+"%",top:(100-e)/2+"%"}}),[t,c,l]),h=Object(s.useCallback)((function(){var e=new Blob([a]),t=window.document.createElement("a");t.download="targets.mind",t.href=window.URL.createObjectURL(e),t.click(),window.URL.revokeObjectURL(t.href)}),[a]);return Object(u.a)("div",null,Object(u.a)("div",{className:"tabs-container"},Object(u.a)("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(d.a)("tabs")},v.map((function(e){return Object(u.a)("li",{role:"tab",className:Object(d.a)("tabs__item",{"tabs__item--active":c===e},b.a.tabItem),key:e,onClick:function(){o(e)}},"Image ",e+1)})))),Object(u.a)("div",{className:"tabs-container"},Object(u.a)("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(d.a)("tabs")},j.map((function(e){return Object(u.a)("li",{role:"tab",className:Object(d.a)("tabs__item",{"tabs__item--active":l===e},b.a.tabItem),key:e,onClick:function(){p(e)}},"Scale ",e+1)})))),Object(u.a)("div",{className:b.a.visualizeCanvasWrapper},Object(u.a)("canvas",{style:O,className:b.a.visualizeCanvas,ref:n})),Object(u.a)("div",{className:"padding-vert--md"},Object(u.a)("button",{className:Object(d.a)("button","button--primary",b.a.startButton),onClick:h},"Download compiled")))},h=function(){var e=Object(s.useState)("upload"),t=e[0],a=e[1],n=Object(s.useState)(null),r=n[0],c=n[1],o=Object(s.useState)(null),i=o[0],l=o[1],b=Object(s.useCallback)((function(e,t){c(e),l(t),a("visualize")}),[]);return Object(u.a)(p.a,{mdxType:"BrowserOnly"},(function(){return Object(u.a)("div",null,"upload"===t&&Object(u.a)(j,{onDataReady:b,mdxType:"UploadTab"}),"visualize"===t&&Object(u.a)(O,{dataList:r,exportedBuffer:i,mdxType:"VisualizeTab"}))}))},w={toc:v,UploadTab:j,VisualizeTab:O,Compile:h};function g(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(u.a)("wrapper",Object(n.a)({},w,a,{components:t,mdxType:"MDXLayout"}),Object(u.a)(h,{mdxType:"Compile"}))}g.isMDXComponent=!0},192:function(e,t,a){e.exports={startButton:"startButton_BGB-",visualizeCanvasWrapper:"visualizeCanvasWrapper_2KCN",visualizeCanvas:"visualizeCanvas_1hSp",tabItem:"tabItem_2bep"}}}]);